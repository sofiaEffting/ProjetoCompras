<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../assets/css/pag_principal.css">
    <link rel="shortcut icon" href="img/logoifc.png" type="image/x-icon">
    <title>SCA - Sistema de Compras Acadêmicas</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
</head>
<body>
    <div class="titulo">        
        <h1 class="sca">SCA - Sistema de Compras Acadêmicas IFC Blumenau</h1>
        <span class="mobile">SCA - IFC Blumenau</span>
        <a href="../main/logout">SAIR</a>
    </div>
    <form action="../pedido/gerarPedido">
        <table class="table" style="margin: 2% auto; width: 80%;">
            <thead class="thead-dark">
              <tr>
                <th scope="col">#</th>
                <th scope="col">Categoria</th>
                <th scope="col">Item</th>
                <th scope="col">SIPAC</th>
                <th scope="col">CATMAT/CATSER</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">1</th>
                <td>
                    <select name="" onchange="buscaItens(this)" id="categoria1">
                        <option value="0"> --Selecione-- </option>
                        <option value="teste">teste</option>
                    </select>
                </td>
                <td id="item1">

                </td>
                <td>@mdo</td>
                <td>bla</td>
              </tr>
              <tr>
                <th scope="row">2</th>
                <td>Jacob</td>
                <td>Thornton</td>
                <td>@fat</td>
                <td>ble</td>
              </tr>
              <tr>
                <th scope="row">3</th>
                <td>Larry</td>
                <td>the Bird</td>
                <td>@twitter</td>
                <td>bli</td>
              </tr>
            </tbody>
          </table>
        <input type="submit" value="Fazer pedido">
    </form>

    <script>
        function buscaItens(prElemento){
            var xhr = new XMLHttpRequest();
            let param = prElemento.value;
            let linha = prElemento.id[prElemento.id.length -1];
            console.log(linha);
            xhr.open("GET", "../ajax/buscaItens.php?categoria=" + param , true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var resposta = JSON.parse(xhr.responseText);

                    let item = document.getElementById("item" + linha);

                    var select = document.createElement("select");

                    resposta.forEach(element => {
                        // Cria e configura a opção
                        var option = document.createElement("option");
                        option.value = element["sipac"];
                        option.textContent = element["descricao"];

                        // Adiciona a opção ao select
                        select.appendChild(option);
                    });

                    // Adiciona o select ao elemento item
                    item.appendChild(select);
                }
            };
            xhr.send();
        }
    </script>
</body>
</html>